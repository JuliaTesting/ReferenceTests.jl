<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · ReferenceTests.jl</title><meta name="title" content="Home · ReferenceTests.jl"/><meta property="og:title" content="Home · ReferenceTests.jl"/><meta property="twitter:title" content="Home · ReferenceTests.jl"/><meta name="description" content="Documentation for ReferenceTests.jl."/><meta property="og:description" content="Documentation for ReferenceTests.jl."/><meta property="twitter:description" content="Documentation for ReferenceTests.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>ReferenceTests.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Contents"><span>Contents</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li><li><a class="tocitem" href="#Public-Interface"><span>Public Interface</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaTesting/ReferenceTests.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaTesting/ReferenceTests.jl/blob/master/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ReferenceTests.jl-Documentation"><a class="docs-heading-anchor" href="#ReferenceTests.jl-Documentation">ReferenceTests.jl Documentation</a><a id="ReferenceTests.jl-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#ReferenceTests.jl-Documentation" title="Permalink"></a></h1><p>ReferenceTests.jl is a Julia package that adds a couple of additional macros to your testing toolbox. In particular, it focuses on functionality for testing values against reference files, which in turn the package can help create and update if need be. ReferenceTests.jl is build on top of <a href="https://github.com/JuliaIO/FileIO.jl"><code>FileIO.jl</code></a> and designed to be used alongside <code>Base.Test</code>.</p><h2 id="Contents"><a class="docs-heading-anchor" href="#Contents">Contents</a><a id="Contents-1"></a><a class="docs-heading-anchor-permalink" href="#Contents" title="Permalink"></a></h2><ul><li><a href="#ReferenceTests.jl-Documentation">ReferenceTests.jl Documentation</a></li><li class="no-marker"><ul><li><a href="#Contents">Contents</a></li><li><a href="#Index">Index</a></li><li><a href="#Public-Interface">Public Interface</a></li></ul></li></ul><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#ReferenceTests.psnr_equality"><code>ReferenceTests.psnr_equality</code></a></li><li><a href="#ReferenceTests.@io2str"><code>ReferenceTests.@io2str</code></a></li><li><a href="#ReferenceTests.@test_reference"><code>ReferenceTests.@test_reference</code></a></li><li><a href="#ReferenceTests.@withcolor"><code>ReferenceTests.@withcolor</code></a></li></ul><h2 id="Public-Interface"><a class="docs-heading-anchor" href="#Public-Interface">Public Interface</a><a id="Public-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Public-Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReferenceTests.@withcolor" href="#ReferenceTests.@withcolor"><code>ReferenceTests.@withcolor</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@withcolor ex</code></pre><p>Make sure that <code>ex</code> is evaluated while <code>Base.have_color</code> is set to <code>true</code>. The original value of <code>Base.have_color</code> will be restored afterwards.</p><p>This macro is particularily useful for CI, where it is not unusual that  <code>julia</code> is executed without the <code>--color=yes</code> argument by default.</p><pre><code class="language-julia hljs">@withcolor print_with_color(:green, &quot;foo&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaTesting/ReferenceTests.jl/blob/895e4be3359c609578a3154b8f3348d914b18b5f/src/utils.jl#L62-L76">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReferenceTests.@io2str" href="#ReferenceTests.@io2str"><code>ReferenceTests.@io2str</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@io2str ex</code></pre><p>Search and replace the placeholder <code>::IO</code> with a newly allocated <code>Base.IOBuffer</code> which is afterwards converted to a string and returned.</p><p>This macro allows a user to conveniently test text-based printing functionality that require an <code>IO</code> argument. A particularly common example of such would be a custom <code>Base.show</code> method.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using ReferenceTests

julia&gt; @io2str print(::IO, &quot;Hello World&quot;)
&quot;Hello World&quot;

julia&gt; @io2str show(IOContext(::IO, :limit=&gt;true, :displaysize=&gt;(10,10)), &quot;text/plain&quot;, ones(5))
&quot;5-element Array{Float64,1}:
 1.0
 1.0
 1.0
 1.0
 1.0&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaTesting/ReferenceTests.jl/blob/895e4be3359c609578a3154b8f3348d914b18b5f/src/utils.jl#L1-L28">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReferenceTests.@test_reference" href="#ReferenceTests.@test_reference"><code>ReferenceTests.@test_reference</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@test_reference filename expr [by] [kw...]</code></pre><p>Tests that the expression <code>expr</code> with reference <code>filename</code> using equality test strategy <code>by</code>.</p><p>The pipeline of <code>test_reference</code> is:</p><ol><li>preprocess <code>expr</code></li><li>read and preprocess <code>filename</code> via FileIO.jl</li><li>compare the results using <code>by</code></li><li>if test fails in an interactive session (e.g, <code>include(test/runtests.jl)</code>), an interactive dialog will be trigered.</li></ol><p>Arguments:</p><ul><li><code>filename::String</code>: <em>relative</em> path to the file that contains the macro invocation.</li><li><code>expr</code>: the actual content used to compare.</li><li><code>by</code>: the equality test function. By default it is <code>isequal</code> if not explicitly stated.</li><li><code>format</code>: Force reading the file using a specific format</li></ul><p><strong>Types</strong></p><p>The file-extension of <code>filename</code>, as well as the type of the result of evaluating <code>expr</code>, determine how contents are processed and compared. The contents is treated as:</p><ul><li>Images when <code>expr</code> is an image type, i.e., <code>AbstractArray{&lt;:Colorant}</code>;</li><li>SHA256 when <code>filename</code> endswith <code>*.sha256</code>;</li><li>Any file-type which FileIO.jl handles and with the proper backend loaded;</li><li>Text as a fallback.</li></ul><p><strong>Any FileIO.jl handled filetype</strong></p><p>Any file-types which can be read by <a href="https://github.com/JuliaIO/FileIO.jl">FileIO.jl</a> can be used. Note that most Julia values can be stored using packages such as, e.g., <a href="https://github.com/JuliaIO/BSON.jl">BSON.jl</a> or <a href="https://github.com/JuliaIO/JLD.jl">JLD</a> and can thus be used in reference-tests.</p><p><strong>Images</strong></p><p>Images are compared <em>approximately</em> using a different <code>by</code> to ignore most encoding and decoding errors. The default function is generated from <a href="#ReferenceTests.psnr_equality"><code>psnr_equality</code></a>.</p><p>The file can be either common image files (e.g., <code>*.png</code>), which are handled by <code>FileIO</code>, or text-coded <code>*.txt</code> files, which is handled by <code>ImageInTerminal</code>. Text-coded image has less storage requirements and also allows to view the reference file in a simple terminal using <code>cat</code>.</p><p><strong>SHA256</strong></p><p>The hash of the <code>expr</code> and content of <code>filename</code> are compared.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>This is useful for a convenient low-storage way of making sure that the return value doesn&#39;t change for selected test cases.</p></div></div><p><strong>Fallback</strong></p><p>Simply test the equality of <code>expr</code> and the contents of <code>filename</code> without any preprocessing. Note that reading <code>filename</code> will return a <code>String</code>.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs"># compare text-file against string representation of a value
@test_reference &quot;stringtest1.txt&quot; collect(1:20)

# test number with absolute tolerance 10
@test_reference &quot;references/string3.txt&quot; 1338 by=(ref, x)-&gt;isapprox(ref, x; atol=10)

# store a floating point array ar in BSON-file and compare it back.
# Note that a Dict is needed and the custom comparison function.
using BSON
comp(d1, d2) = keys(d1)==keys(d2) &amp;&amp;
    all([ v1≈v2 for (v1,v2) in zip(values(d1), values(d2))])
@test_reference &quot;reftest-files/X.bson&quot; Dict(:ar=&gt;[1, pi, 4.5]) by=comp

# store as string using ImageInTerminal with encoding size (5,10)
using TestImages
@test_reference &quot;camera.txt&quot; testimage(&quot;cameraman&quot;) size=(5,10)

# using folders in the relative path is allowed
@test_reference &quot;references/camera.png&quot; testimage(&quot;cameraman&quot;)

# Images can also be stored as hash. Note however that this
# can only check for equality (no tolerance possible)
@test_reference &quot;references/camera.sha256&quot; testimage(&quot;cameraman&quot;)

# test images with custom Peak Signal-to-Noise Ratio (psnr) threshold
@test_reference &quot;references/camera.png&quot; testimage(&quot;cameraman&quot;) by=psnr_equality(20)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaTesting/ReferenceTests.jl/blob/895e4be3359c609578a3154b8f3348d914b18b5f/src/test_reference.jl#L1-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReferenceTests.psnr_equality" href="#ReferenceTests.psnr_equality"><code>ReferenceTests.psnr_equality</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">psnr_equality(threshold=25) -&gt; f</code></pre><p>Generates an equality comparison function in terms of Peak Signal-to-Noise Ratio (PSNR).</p><p>The return function <code>f</code> accepts two images <code>reference</code> and <code>actual</code> as its inputs; <code>f(reference, actual) == true</code> if <code>psnr(reference, actual) &gt;= threshold</code>.</p><p>This function is useful for image comparison; higher PSNR means higher image similarity. Hence if you want to loose the equality test creterion, you can use a <strong>smaller</strong> threshold value, e.g.,</p><pre><code class="language-julia hljs">@test_reference &quot;references/camera.png&quot; testimage(&quot;cameraman&quot;) by=psnr_equality(20)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaTesting/ReferenceTests.jl/blob/895e4be3359c609578a3154b8f3348d914b18b5f/src/equality_metrics.jl#L20-L35">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Thursday 28 December 2023 05:28">Thursday 28 December 2023</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
